---
title: 'Midterm Project'
subtitle: 'CUNY DATA 624|2023 Summer I'
author: 'Group 3: Daniel Sullivan, Jeff Parks, Lwin Shwe, Matthew Katz'
# abstract: 'abstract text'
format:
  docx:
    highlight-style: arrow
    number-sections: false
    number-depth: 2
    reference-doc: ../../../templates/quarto-word-template.docx
    toc: true
    toc-depth: 1
    toc-title: Contents
editor: visual
execute:
  echo: false
  eval: true
  include: true
  message: false
  warning: false
# output:
#   html_document:
#     toc: yes
#     toc_float: yes
#     theme: united
page-layout: article
---

```{r setup}
# libraries
library(tidyverse)
library(fpp2)
library(readxl)
library(zoo)
library(seasonal)
library(kableExtra)

# ggplot
theme_set(theme_light())
```

```{r functions}
expand_dates <- function(my_data){
  
  # create full date sequence
  date_seq <- seq(min(my_data$dates), max(my_data$dates), by = "day")

  # convert original data frame to a zoo object
  zoo_obj <- zooreg(my_data$values, order.by = my_data$dates, frequency=365)

  # merge with a zoo object containing consecutive dates
  merged_obj <- merge(zoo_obj, zooreg(, order.by = date_seq, frequency=365))

  # replace NA with 0
  merged_obj_na <- merged_obj %>% replace(is.na(.), 0)

  # convert to a ts object
  my_ts <- ts(coredata(merged_obj_na)[,1], 
              start = c(year(min(my_data$dates)),
                        yday(min(my_data$dates))), frequency=365) 
  
  return(my_ts)
}

nice_table <- function(df, cap=NULL, cols=NULL, dig=3, fw=F){
  if (is.null(cols)) {c <- colnames(df)} else {c <- cols}
  table <- df %>% 
    kable(caption=cap, col.names=c, digits=dig) %>% 
    kable_styling(
      bootstrap_options = c("striped", "hover", "condensed"),
      html_font = 'monospace',
      full_width = fw)
  return(table)
}
```

```{r load-data}
# load data
df <- read_xls('../data/Data Set for Class.xls', sheet='Set for Class') %>%
  mutate(Date = as.Date(SeriesInd-2, origin = '1900-01-01'))
```

{{< pagebreak >}}

# Overview

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa. Cras ultricies neque lorem, in fermentum turpis venenatis nec. Aenean non diam interdum, tincidunt dui in, maximus orci.

Praesent eget enim id erat volutpat euismod. Vivamus euismod turpis nec sollicitudin accumsan. Duis maximus finibus auctor. Phasellus quis ornare nunc, id porttitor elit. Donec sit amet vulputate arcu. Nulla sodales lacinia nisl, sed hendrerit ex consectetur eget.

Vivamus euismod turpis nec sollicitudin accumsan. Duis maximus finibus auctor. Phasellus quis ornare nunc, id porttitor elit. Donec sit amet vulputate arcu. Nulla sodales lacinia nisl, sed hendrerit ex consectetur eget.

{{< pagebreak >}}

# Series One

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa. Cras ultricies neque lorem, in fermentum turpis venenatis nec.

```{r data_s01}
df_s01 <- df %>%
  filter(category == 'S01') %>%
  select(c(Date,Var01,Var02)) %>%
  head(1622)
```

## Variables

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa. Cras ultricies neque lorem, in fermentum turpis venenatis nec.

## Analysis

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa.

```{r}

```

## Forecast

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa.

```{r}

```

{{< pagebreak >}}

# Series Two

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa. Cras ultricies neque lorem, in fermentum turpis venenatis nec. Aenean non diam interdum, tincidunt dui in, maximus orci.

```{r data_s02}
df_s02 <- df %>%
  filter(category == 'S02') %>%
  select(c(Date,Var02,Var03)) %>%
  head(1622)

ts_s02_v02 <- df_s02 %>%
  select(dates=Date,values=Var02) %>%
  drop_na() %>%
  expand_dates()

ts_s02_v03 <- df_s02 %>%
  select(dates=Date,values=Var03) %>%
  drop_na() %>%
  expand_dates()
```

## Variables

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa.

```{r, include=TRUE}
#| layout-ncol: 2

# 7-MA moving average
ts_s02_v02_ma7 <- ma(ts_s02_v02, order=7, centre=TRUE)

autoplot(ts_s02_v02_ma7) + 
ggtitle('7-MA - Variable 2') +
xlab('Year') + ylab('')

# 7-MA moving average
ts_s02_v03_ma7 <- ma(ts_s02_v03, order=7, centre=TRUE)

autoplot(ts_s02_v03_ma7) + 
ggtitle('7-MA - Variable 3') +
xlab('Year') + ylab('')
```

## Analysis

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa. Cras ultricies neque lorem, in fermentum turpis venenatis nec. Aenean non diam interdum, tincidunt dui in, maximus orci.

```{r}
#| layout-ncol: 2

# seasonality
ggAcf(ts_s02_v02_ma7, lag=90)  + 
  ggtitle('ACF - Variable 2') +
  xlab('Year')

# stl decomp
mstl(ts_s02_v02_ma7) %>% 
  autoplot() + 
  ggtitle('STL Decomp - Variable 2') +
  xlab('Year')

```

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa.

```{r}
#| layout-ncol: 2
# seasonality
ggAcf(ts_s02_v03_ma7, lag=90) + 
  ggtitle('ACF - Variable 3') +
  xlab('Year')

# stl decomp
mstl(ts_s02_v03_ma7) %>% 
  autoplot() + 
  ggtitle('STL Decomp - Variable 3') +
  xlab('Year')
```

## Forecast

Praesent ac ipsum ut leo facilisis consequat. Sed aliquam odio vitae est volutpat, sed tincidunt eros imperdiet. Maecenas sit amet dictum massa. Cras ultricies neque lorem, in fermentum turpis venenatis nec. Aenean non diam interdum, tincidunt dui in, maximus orci.

```{r}
#| layout-ncol: 2

# ets forecast with 7-MA moving average
f_s02_v02_ma7 <- forecast(ts_s02_v02_ma7, h=140) 

autoplot(f_s02_v02_ma7) + 
  ggtitle('ETS Forecast - Variable 1') +
  xlab('Year') + ylab('')

# ets forecast with 7-MA moving average
f_s02_v03_ma7 <- forecast(ts_s02_v03_ma7, h=140) 

autoplot(f_s02_v03_ma7) + 
  ggtitle('ETS Forecast - Variable 2') +
  xlab('Year') + ylab('')
```

{{< pagebreak >}}

# Series Three

```{r data_s03}
df_s03 <- df %>%
  filter(category == 'S03') %>%
  select(c(Date,Var05,Var07)) %>%
  head(1622)
```

## Variables

```{r}

```

## Analysis

```{r}

```

## Forecast

```{r}

```

{{< pagebreak >}}

# Series Four

```{r data_s04}
df_s04 <- df %>%
  filter(category == 'S04') %>%
  select(c(Date,Var01,Var02)) %>%
  head(1622)
```

## Variables

```{r}

```

## Analysis

```{r}

```

## Forecast

```{r}

```

{{< pagebreak >}}

# Series Five

```{r data_s05}
df_s05 <- df %>%
  filter(category == 'S05') %>%
  select(c(Date,Var02,Var03)) %>%
  head(1622)
```

## Variables

```{r}

```

## Analysis

```{r}

```

## Forecast

```{r}

```

{{< pagebreak >}}

# Series Six

```{r data_s06}
df_s06 <- df %>%
  filter(category == 'S06') %>%
  select(c(Date,Var05,Var07)) %>%
  head(1622)
```

## Variables

```{r}

```

## Analysis

```{r}

```

## Forecast

```{r}

```

{{< pagebreak >}}

# Conclusions

{{< pagebreak >}}

# Appendix

## R Code

```{r}
#| echo: true
#| eval: false

# code here
```
